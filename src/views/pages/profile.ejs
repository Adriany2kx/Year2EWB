<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile</title>
    <link rel="stylesheet" href="/css/profile.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
</head>
<body>

    <%- include('../common/navigation') %>

    <div class="container">
        <div class="header">
            <h1>Profile</h1>
            <button class="settings-btn" aria-label="Settings">
                <i class="fa-solid fa-cog"></i>
            </button>
        </div>

        <div class="profile-pic">
            <% if (user && user.Forename && user.Surname) { %>
                <div class="initials"><%= user.Forename.charAt(0).toUpperCase() %><%= user.Surname.charAt(0).toUpperCase() %></div>
            <% } else { %>
                <div class="initials">JD</div>
            <% } %>
        </div>

        <button id="editProfileBtn" class="edit-btn">edit your profile</button>

        <div class="activity-overview">
            <h2>Activity Overview</h2>
            <div class="activity-box">
                <p>My Applications: "4 job applications submitted"</p>
                <p>Volunteering Joined: "3 events joined"</p>
                <p>Workshops Attended: "2 workshops completed"</p>
                <a href="#">view all</a>
            </div>
        </div>

        <div class="menu-buttons">
            <button id="changePasswordBtn">Change Password</button>
            <button id="notificationPreferencesBtn">Notification Preferences</button>
            <button>Language Settings</button>
            <button>Help / FAQ</button>
        </div>

        <a href="/users/logout" class="logout-btn">Logout</a>
    </div>

    <div id="editProfileModal" class="modal">
        <div class="profile-modal-content">
            <button id="closeEditProfileModal" class="modal-close-btn">&times;</button>
            <h2 class="profile-modal-title">Edit Profile</h2>
            <form action="/profile/update" method="POST" enctype="multipart/form-data">
                <!-- 1. Basic Information -->
                <div class="profile-avatar-upload">
                    <% if (user && user.avatarUrl) { %>
                        <img id="profileAvatarPreview" src="<%= user.avatarUrl %>" alt="Avatar" class="profile-avatar-img">
                    <% } else { %>
                        <img id="profileAvatarPreview" src="/images/default-avatar.png" alt="Avatar" class="profile-avatar-img">
                    <% } %>
                    <input type="file" class="profile-avatar-input" name="profile_pic" accept="image/*">
                    <button type="button" id="removeAvatarBtn" class="profile-avatar-remove">Remove</button>
                </div>
                <label for="forename">Full Name</label>
                <input type="text" id="forename" name="forename" class="profile-input" value="<%= user.Forename %>" required>
                <label for="username">Username</label>
                <input type="text" id="username" name="username" class="profile-input" value="<%= user.Username %>">
                <label for="bio">Bio/About Me</label>
                <textarea id="bio" name="bio" class="profile-input" rows="2"><%= user.Bio || '' %></textarea>
                <label for="gender">Gender</label>
                <select id="gender" name="gender" class="profile-input">
                    <option value="">Prefer not to say</option>
                    <option value="male" <%= user.Gender === 'male' ? 'selected' : '' %>>Male</option>
                    <option value="female" <%= user.Gender === 'female' ? 'selected' : '' %>>Female</option>
                    <option value="other" <%= user.Gender === 'other' ? 'selected' : '' %>>Other</option>
                </select>
                <label for="dob">Date of Birth</label>
                <input type="date" id="dob" name="dob" class="profile-input" value="<%= user.DOB ? new Date(user.DOB).toISOString().split('T')[0] : '' %>">
                <hr class="profile-modal-divider">
                <!-- 2. Contact Information -->
                <label for="email">Email Address</label>
                <input type="email" id="email" name="email" class="profile-input" value="<%= user.Email %>" required>
                <small class="profile-note">If you change your email, you may need to verify it.</small>
                <label for="phone">Phone Number</label>
                <input type="tel" id="phone" name="phone" class="profile-input" value="<%= user.Phone || '' %>">
                <hr class="profile-modal-divider">
                <!-- 3. Account & Security Settings -->
                <h3 class="profile-modal-subtitle">Account & Security</h3>
                <label><input type="checkbox" name="twoFactor" <%= user.TwoFactor ? 'checked' : '' %>> Two-factor authentication</label><br>
                <label><input type="checkbox" name="accountPrivate" <%= user.AccountPrivate ? 'checked' : '' %>> Account is private</label><br>
                <label>Linked Accounts:</label>
                <div class="profile-linked-accounts">
                    <button type="button" class="profile-linked-btn"><img src="/images/google.svg" alt="Google logo">Google</button>
                    <button type="button" class="profile-linked-btn"><img src="/images/facebook.svg" alt="Facebook logo">Facebook</button>
                    <button type="button" class="profile-linked-btn"><img src="/images/apple.svg" alt="Apple logo">Apple</button>
                </div>
                <button type="submit" class="profile-modal-save">Save Changes</button>
            </form>
        </div>
    </div>

    <div id="notificationModal" class="modal">
        <div class="notification-modal-content">
            <button id="closeNotificationModal" class="modal-close-btn">&times;</button>
            <h2 class="modal-title">Notification Preferences</h2>
            <form id="notificationForm">
                 <div class="notification-section">
                    <p class="notification-note">Select which notifications you want to receive.</p>
                    <button type="button" id="selectAllBtn" class="notification-btn">Select All</button>
                    <button type="button" id="deselectAllBtn" class="notification-btn">Deselect All</button>
                    <button type="button" id="resetDefaultsBtn" class="notification-btn">Reset to Default</button>
                </div>
                <hr class="profile-modal-divider">
                <p>...</p>
                <button type="submit" class="notification-modal-save">Save Preferences</button>
            </form>
        </div>
    </div>

    <%- include('../common/footer') %>

    <script src="/js/profile.js"></script>
</body>
</html>